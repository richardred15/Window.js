/*! windowjs 2022-02-21 */
class Builder{constructor(){}container(e){let t=document.createElement("div");return t.className="windowJSContainer "+e,t}form(e,t,i){let s=document.createElement("form");s.className="windowJSForm","string"==typeof t?s.setAttribute("action",t):s.onsubmit=function(e){return t(s)};for(var n of i){var o=n[0];n.splice(0,1),s.appendChild(e.buildElement(o,n))}return s}textarea(e="",t="",i=()=>{}){let s=document.createElement("textarea");return s.value=e,s.className="windowJSTextarea",s.setAttribute("name",t),s.onchange=function(){i(s)},s}checkbox(e,t){let i=document.createElement("input"),s=(i.setAttribute("type","checkbox"),i.setAttribute("name",e),document.createElement("label")),n=(s.setAttribute("for",e),s.innerHTML=t,s.onclick=function(){i.checked=!i.checked},document.createElement("div"));return n.addClass("windowJSCheckboxContainer"),n.appendChild(i),n.appendChild(s),n}button(e="Button",t=()=>{}){let i=document.createElement("div");return i.className="windowJSButton",i.innerHTML=e,i.onclick=function(){t(i)},i}input(e,t,i=""){let s=document.createElement("input");return s.setAttribute("type",e),s.setAttribute("name",t),s.setAttribute("placeholder",i),s}text(e){let t=document.createElement("div");return t.className="windowJSTextParagraph",t.innerHTML=e,t}select(e="testing",s){let t=document.createElement("div"),n=(t.className="windowJSSelectContainer",document.createElement("div")),i=(n.className="windowJSSelect",n.setAttribute("value",""),document.createElement("div")),o=(i.className="windowJSSelectTitle",i.onclick=function(e){var t=this.parentElement.parentElement.hasClass("open");document.querySelectorAll(".windowJSSelectContainer.open").forEach(e=>{e.removeClass("open")}),t||this.parentElement.parentElement.toggleClass("open")},i.innerHTML="Select...",document.createElement("select")),d=(o.setAttribute("name",e),o.className="windowJSSelectInput",[]),l=[];for(let i in s){var h=s[i];let e=document.createElement("div"),t=document.createElement("option");t.setAttribute("value",i),e.className="windowJSSelectOption",l.push(t),e.setAttribute("value",i),e.onclick=function(){n.querySelector(".windowJSSelectTitle").innerHTML=this.innerHTML,n.parentElement.toggleClass("open"),n.setAttribute("value",i),o.value=i,o.setAttribute("value",i)},e.innerHTML=h,d.push(e)}n.appendChild(i);for(var a of d)n.appendChild(a);for(var r of l)o.appendChild(r);return t.appendChild(n),t.appendChild(o),t}}class WindowJSWindow{constructor(e="WindowJS",t=100,i=100,s=350,n=400){this.built=!1,this.title=e,this.largeTitle=!1,this.x=t,this.y=i,this.width=s,this.height=n,this.minWidth=s,this.minHeight=n,this.lastLocation={x:t,y:i},this.containers={},this.rawHTML="",this.rawContentHTML="",this.rawTemplateHTML="",this.windowElement=document.createElement("div"),this.dragged=!1,this.minimized=!1,this.maximized=!1,this.sizeUpdateTimeout=0}dragStart(){this.dragged||(this.windowElement.addClass("dragging"),this.dragged=!0)}dragStop(){this.dragged&&(this.windowElement.removeClass("dragging"),this.dragged=!1)}setSize(e,t){e<=this.minWidth&&(e=this.minWidth),t<=this.minHeight&&(t=this.minHeight),this.width=e,this.height=t,this.updateSize()}center(){this.setLocation(window.innerWidth/2-this.width/2,window.innerHeight/2-this.height/2)}setLocationRelative(e,t){this.setLocation(this.x+e,this.y+t)}setLocation(e,t){this.lastLocation={x:this.x,y:this.y},this.x=e,this.y=t,this.updateLocation()}setTitle(t){if(this.built){this.title=t,this.largeTitle=!1;let e=this.titleBarElement.querySelector(".windowJSTitleBarTitle");if(e.innerHTML=t,e.scrollWidth>e.clientWidth){for(this.largeTitle=!0;e.scrollWidth>e.clientWidth;)e.innerHTML=e.innerHTML.slice(0,e.innerHTML.length-1),e.innerHTML=e.innerHTML.trim();e.innerHTML=e.innerHTML.slice(0,e.innerHTML.length-3),e.innerHTML+="..."}}}updateLocation(){this.windowElement.style.top=this.y+"px",this.windowElement.style.left=this.x+"px",this.onmove()}updateSize(){return this.windowElement.style.width=this.width+"px",this.windowElement.style.height=this.height+"px",clearTimeout(this.sizeUpdateTimeout),this.sizeUpdateTimeout=setTimeout(()=>{this.onresize()},300),!0}onmove(){}onresize(){this.setTitle(this.title)}isClicked(e){return this.windowElement.contains(e)}isTitleBarClick(e){return this.titleBarElement.contains(e)}newContainer(){}buildElement(){this.buildTemplate();let e=document.createElement("div");e.innerHTML=this.rawHTML,this.windowElement=e.firstChild,this.titleBarElement=this.windowElement.getElementsByClassName("windowJSTitleBar")[0],this.body=this.windowElement.querySelector(".windowJSContent"),this.containers.main=document.createElement("div"),this.containers.main.className="windowJSContainer main",this.body.appendChild(this.containers.main),this.footer=this.body.querySelector(".footer"),this.closeButton=this.windowElement.querySelector(".windowJSTitleBarControl.close"),this.minimizeButton=this.windowElement.querySelector(".windowJSTitleBarControl.minimize"),this.closeButton=this.windowElement.querySelector(".windowJSTitleBarControl.close"),this.maximizeButton=this.windowElement.querySelector(".windowJSTitleBarControl.maximize"),this.attachListeners(),this.built=!0}append(e){this.containers.main.appendChild(e),this.autoResize()}setTemplates(e,t){this.rawTemplateHTML=e,this.rawContentHTML=t,this.buildElement()}attachListeners(){this.minimizeButton.addEventListener("click",e=>{this.toggleMinimized()}),this.maximizeButton.addEventListener("click",e=>{this.toggleMaximized()}),this.closeButton.addEventListener("click",e=>{this.close()})}close(){this.onclose(),winjs.removeWindow(this.id)}onclose(){}toggleMinimized(){this.minimized?this.windowElement.removeClass("minimized"):this.windowElement.addClass("minimized"),this.minimized=!this.minimized}toggleMaximized(){this.maximized?this.windowElement.removeClass("maximized"):this.windowElement.addClass("maximized"),this.maximized=!this.maximized}buildTemplate(){var e=this.rawContentHTML,t=this.title,t={x:this.x,y:this.y,height:this.height,width:this.width,id:this.id,title:t,content:e};this.rawHTML=this.parseTemplate(this.rawTemplateHTML,t),this.setTitle(this.title)}html(){return this.windowElement.outerHTML}parseTemplate(e,t){for(var i in t){var s=t[i],i=new RegExp("\\$\\{"+i+"\\}","g");e=e.replace(i,s)}return e}attach(e=document.body){e.appendChild(this.windowElement),this.autoResize()}autoResize(){this.windowElement.scrollHeight>this.windowElement.clientHeight&&(this.windowElement.addClass("resizing"),this.setSize(this.width,this.height+this.windowElement.scrollHeight-this.windowElement.clientHeight),this.minHeight=this.windowElement.scrollHeight),this.windowElement.scrollWidth>this.windowElement.clientWidth&&(this.windowElement.addClass("resizing"),this.setSize(this.width,this.width+this.windowElement.scrollWidth-this.windowElement.clientWidth),this.minWidth=this.windowElement.scrollWidth),this.windowElement.removeClass("resizing")}}class WindowJS{constructor(){this.windows=[],this.builder=new Builder,this.nextWindowID=1001,this.loaded=!1,this.dragging=!1,this.resizing=!1,this.pointerdown=!1,this.lastClickTime=0,this.selectedWindow=null,this.mousePosition={x:0,y:0};let e=this;window.onload=function(){e.attachListeners(),e.init().then(()=>{e.onload()})}}focusWindow(e){for(var t of this.windows)t.windowElement.removeClass("focused");this.windows[e].windowElement.addClass("focused")}attachListeners(){window.addEventListener("pointerdown",t=>{for(var i in this.pointerdown=!0,this.mousePosition={x:t.clientX,y:t.clientY},this.windows){let e=this.windows[i];var s;e.minimized?e.minimized&&e.isClicked(t.target)&&e.toggleMinimized():e.isClicked(t.target)&&(e.isTitleBarClick(t.target)?this.selectedWindow=e:t.target.hasClass("windowJSWindowBorder")&&(s=t.target.className.replace("windowJSWindowBorder ","").replace("corner ",""),this.resizing=s,this.selectedWindow=e,this.selectedWindow.windowElement.addClass("resizing")),this.focusWindow(i))}this.lastClickTime}),window.addEventListener("blur",e=>{this.dragging=!1,this.pointerdown=!1,this.resizing=!1,this.selectedWindow&&this.dragging&&this.selectedWindow.dragStop(),this.selectedWindow=null}),window.addEventListener("pointermove",e=>{if(this.pointerdown&&this.resizing)switch(this.resizing){case"right":this.selectedWindow.setSize(this.selectedWindow.width+(e.clientX-this.mousePosition.x),this.selectedWindow.y),this.selectedWindow.updateSize();break;case"left":this.selectedWindow.setSize(this.selectedWindow.width-(e.clientX-this.mousePosition.x),this.selectedWindow.y),this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"bottom":this.selectedWindow.height+=e.clientY-this.mousePosition.y,this.selectedWindow.updateSize();break;case"top":this.selectedWindow.height-=e.clientY-this.mousePosition.y,this.selectedWindow.y+=e.clientY-this.mousePosition.y,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"bottomright":this.selectedWindow.height+=e.clientY-this.mousePosition.y,this.selectedWindow.width+=e.clientX-this.mousePosition.x,this.selectedWindow.updateSize();break;case"bottomleft":this.selectedWindow.height+=e.clientY-this.mousePosition.y,this.selectedWindow.width-=e.clientX-this.mousePosition.x,this.selectedWindow.x+=e.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"topright":this.selectedWindow.height-=e.clientY-this.mousePosition.y,this.selectedWindow.y+=e.clientY-this.mousePosition.y,this.selectedWindow.width+=e.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"topleft":this.selectedWindow.height-=e.clientY-this.mousePosition.y,this.selectedWindow.y+=e.clientY-this.mousePosition.y,this.selectedWindow.width-=e.clientX-this.mousePosition.x,this.selectedWindow.x+=e.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation()}else!this.pointerdown||this.dragging||this.resizing?this.dragging&&this.pointerdown&&!this.resizing&&this.selectedWindow&&e.clientX<=window.innerWidth&&0<e.clientX&&e.clientY<=window.innerHeight&&0<e.clientY&&(this.selectedWindow.dragStart(),this.selectedWindow.setLocationRelative(e.clientX-this.mousePosition.x,e.clientY-this.mousePosition.y)):(this.dragging=!0,this.selectedWindow&&this.selectedWindow.maximized&&(this.selectedWindow.toggleMaximized(),this.selectedWindow.setLocation(e.clientX-this.selectedWindow.width/2,e.clientY-15)));return this.mousePosition={x:e.clientX,y:e.clientY},!0}),window.addEventListener("pointerup",e=>{if(this.resizing&&this.selectedWindow.windowElement.removeClass("resizing"),this.selectedWindow&&this.dragging&&this.selectedWindow.dragStop(),this.selectedWindow&&(this.selectedWindow=null),Date.now()-this.lastClickTime<300)for(var t of this.windows)!t.minimized&&t.isTitleBarClick(e.target)&&t.toggleMaximized();this.resizing=!1,this.dragging=!1,this.pointerdown=!1,this.lastClickTime=Date.now()})}newWindow(e,t,i,s,n){let o=new WindowJSWindow(e,t,i,s,n);return o.id=this.nextWindowID,o.setTemplates(this.rawTemplateHTML,this.rawContentHTML),o.buildTemplate(),this.windows.push(o),this.focusWindow(this.windows.length-1),this.nextWindowID++,o}removeWindow(e){var e=parseInt(e)-1001,t=this.windows[e];document.body.removeChild(t.windowElement),this.windows.splice(e,1)}async init(){this.rawContentHTML=await(await fetch("src/template/example.html")).text(),this.rawTemplateHTML=await(await fetch("src/template/window.html")).text(),this.loaded=!0}onload(){}buildElement(e,t){let i;switch(e){case"select":case"checkbox":case"text":case"input":case"textarea":case"button":i=this.builder[e](...t);break;case"container":i=this.builder.container(t[0]);for(var s of t[1]){var n=s[0];s.splice(0,1),i.appendChild(this.buildElement(n,...s))}break;case"form":i=this.builder[e](this,...t);break;default:return!1}return i}buildWindow(e){let t;for(var i of e){var s=i[0];i.splice(0,1),"window"==s?t=this.newWindow(...i):"container"==s?t.body.appendChild(this.buildElement(s,i)):(s=this.buildElement(s,i))&&t.append(s)}return t}}Element.prototype.addClass=function(e){this.classList.add(e)},Element.prototype.removeClass=function(e){this.classList.remove(e)},Element.prototype.hasClass=function(e){return this.classList.contains(e)},Element.prototype.toggleClass=function(e){this.hasClass(e)?this.removeClass(e):this.addClass(e)};