/*! windowjs 2022-02-19 */
class Builder{constructor(){}buildButton(t="Button",e=()=>{}){let i=document.createElement("div");return i.className="windowJSButton",i.innerHTML=t,i.onclick=e,i}buildInput(t,e,i=""){let s=document.createElement("input");return s.setAttribute("type",t),s.setAttribute("name",e),s.setAttribute("placeholder",i),s}buildParagraph(t){let e=document.createElement("div");return e.className="windowJSTextParagraph",e.innerHTML=t,e}buildSelect(t="testing",i){let e=document.createElement("div"),s=(e.className="windowJSSelectContainer",document.createElement("div")),n=(s.className="windowJSSelect",s.setAttribute("value",""),document.createElement("div")),o=(n.className="windowJSSelectTitle",n.onclick=function(t){var e=this.parentElement.parentElement.hasClass("open");document.querySelectorAll(".windowJSSelectContainer.open").forEach(t=>{t.removeClass("open")}),e||this.parentElement.parentElement.toggleClass("open")},n.innerHTML="Select...",document.createElement("select")),d=(o.setAttribute("name",t),o.className="windowJSSelectInput",[]);for(let e in i){var h=i[e];let t=document.createElement("div");t.className="windowJSSelectOption",t.setAttribute("value",e),t.onclick=function(){s.querySelector(".windowJSSelectTitle").innerHTML=this.innerHTML,s.parentElement.toggleClass("open"),s.setAttribute("value",e),o.setAttribute("value",e)},t.innerHTML=h,d.push(t)}s.appendChild(n);for(var l of d)s.appendChild(l);return e.appendChild(s),e.appendChild(o),e}}class Window{constructor(t="WindowJS",e=100,i=100,s=350,n=400){this.built=!1,this.title=t,this.largeTitle=!1,this.x=e,this.y=i,this.width=s,this.height=n,this.minWidth=280,this.minHeight=375,this.lastLocation={x:e,y:i},this.rawHTML="",this.rawContentHTML="",this.rawTemplateHTML="",this.windowElement=document.createElement("div"),this.dragged=!1,this.minimized=!1,this.maximized=!1,this.sizeUpdateTimeout=0}dragStart(){this.dragged||(this.windowElement.addClass("dragging"),this.dragged=!0)}dragStop(){this.dragged&&(this.windowElement.removeClass("dragging"),this.dragged=!1)}setSize(t,e){this.width=t,this.height=e,this.updateSize()}center(){this.setLocation(window.innerWidth/2-this.width/2,window.innerHeight/2-this.height/2)}setLocationRelative(t,e){this.setLocation(this.x+t,this.y+e)}setLocation(t,e){this.lastLocation={x:this.x,y:this.y},this.x=t,this.y=e,this.updateLocation()}setTitle(e){if(this.built){this.title=e,this.largeTitle=!1;let t=this.titleBarElement.querySelector(".windowJSTitleBarTitle");if(t.innerHTML=e,t.scrollWidth>t.clientWidth){for(this.largeTitle=!0;t.scrollWidth>t.clientWidth;)t.innerHTML=t.innerHTML.slice(0,t.innerHTML.length-1),t.innerHTML=t.innerHTML.trim();t.innerHTML=t.innerHTML.slice(0,t.innerHTML.length-3),t.innerHTML+="..."}}}updateLocation(){0<=this.x&&this.x+this.width<=window.innerWidth?0<=this.y&&this.y+this.height<=window.innerHeight&&(this.windowElement.style.top=this.y+"px",this.windowElement.style.left=this.x+"px",this.onmove()):(this.x=this.lastLocation.x,this.y=this.lastLocation.y)}updateSize(){return this.width<=this.minWidth?(this.width=this.minWidth,!1):this.height<=this.minHeight?(this.height=this.minHeight,!1):(this.windowElement.style.width=this.width+"px",this.windowElement.style.height=this.height+"px",clearTimeout(this.sizeUpdateTimeout),this.sizeUpdateTimeout=setTimeout(()=>{this.onresize()},300),!0)}onmove(){}onresize(){this.setTitle(this.title)}isClicked(t){return this.windowElement.contains(t)}isTitleBarClick(t){return this.titleBarElement.contains(t)}buildElement(){this.buildTemplate();let t=document.createElement("div");t.innerHTML=this.rawHTML,this.windowElement=t.firstChild,this.titleBarElement=this.windowElement.getElementsByClassName("windowJSTitleBar")[0],this.body=this.windowElement.getElementsByClassName("windowJSContent")[0],this.main=this.body.querySelector(".main"),this.footer=this.body.querySelector(".footer"),this.closeButton=this.windowElement.querySelector(".windowJSTitleBarControl.close"),this.minimizeButton=this.windowElement.querySelector(".windowJSTitleBarControl.minimize"),this.closeButton=this.windowElement.querySelector(".windowJSTitleBarControl.close"),this.maximizeButton=this.windowElement.querySelector(".windowJSTitleBarControl.maximize"),this.attachListeners(),this.built=!0}append(t){this.main.appendChild(t)}setTemplates(t,e){this.rawTemplateHTML=t,this.rawContentHTML=e,this.buildElement()}attachListeners(){this.minimizeButton.addEventListener("click",t=>{this.toggleMinimized()}),this.maximizeButton.addEventListener("click",t=>{this.toggleMaximized()}),this.closeButton.addEventListener("click",t=>{this.close()})}close(){this.onclose(),winjs.removeWindow(this.id)}onclose(){}toggleMinimized(){this.minimized?this.windowElement.removeClass("minimized"):this.windowElement.addClass("minimized"),this.minimized=!this.minimized}toggleMaximized(){this.maximized?this.windowElement.removeClass("maximized"):this.windowElement.addClass("maximized"),this.maximized=!this.maximized}buildTemplate(){var t=this.rawContentHTML,e=this.title,e={x:this.x,y:this.y,height:this.height,width:this.width,id:this.id,title:e,content:t};this.rawHTML=this.parseTemplate(this.rawTemplateHTML,e),this.setTitle(this.title)}html(){return this.windowElement.outerHTML}parseTemplate(t,e){for(var i in e){var s=e[i],i=new RegExp("\\$\\{"+i+"\\}","g");t=t.replace(i,s)}return t}attach(t=document.body){t.appendChild(this.windowElement)}}class WindowJS{constructor(){this.windows=[],this.builder=new Builder,this.nextWindowID=1001,this.loaded=!1,this.init().then(()=>{this.onload()}),this.dragging=!1,this.resizing=!1,this.pointerdown=!1,this.lastClickTime=0,this.selectedWindow=null,this.mousePosition={x:0,y:0},this.attachListeners()}focusWindow(t){for(var e of this.windows)e.windowElement.removeClass("focused");this.windows[t].windowElement.addClass("focused")}attachListeners(){window.addEventListener("pointerdown",e=>{for(var i in this.pointerdown=!0,this.mousePosition={x:e.clientX,y:e.clientY},this.windows){let t=this.windows[i];var s;t.minimized?t.minimized&&t.isClicked(e.target)&&t.toggleMinimized():t.isClicked(e.target)&&(t.isTitleBarClick(e.target)?this.selectedWindow=t:e.target.hasClass("windowJSWindowBorder")&&(s=e.target.className.replace("windowJSWindowBorder ","").replace("corner ",""),this.resizing=s,this.selectedWindow=t,this.selectedWindow.windowElement.addClass("resizing")),this.focusWindow(i))}this.lastClickTime}),window.addEventListener("blur",t=>{this.dragging=!1,this.pointerdown=!1,this.resizing=!1,this.selectedWindow&&this.dragging&&this.selectedWindow.dragStop(),this.selectedWindow=null}),window.addEventListener("pointermove",t=>{if(this.pointerdown&&this.resizing)switch(this.resizing){case"right":this.selectedWindow.width+=t.clientX-this.mousePosition.x,this.selectedWindow.updateSize();break;case"left":this.selectedWindow.width-=t.clientX-this.mousePosition.x,this.selectedWindow.x+=t.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"bottom":this.selectedWindow.height+=t.clientY-this.mousePosition.y,this.selectedWindow.updateSize();break;case"top":this.selectedWindow.height-=t.clientY-this.mousePosition.y,this.selectedWindow.y+=t.clientY-this.mousePosition.y,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"bottomright":this.selectedWindow.height+=t.clientY-this.mousePosition.y,this.selectedWindow.width+=t.clientX-this.mousePosition.x,this.selectedWindow.updateSize();break;case"bottomleft":this.selectedWindow.height+=t.clientY-this.mousePosition.y,this.selectedWindow.width-=t.clientX-this.mousePosition.x,this.selectedWindow.x+=t.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"topright":this.selectedWindow.height-=t.clientY-this.mousePosition.y,this.selectedWindow.y+=t.clientY-this.mousePosition.y,this.selectedWindow.width+=t.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation();break;case"topleft":this.selectedWindow.height-=t.clientY-this.mousePosition.y,this.selectedWindow.y+=t.clientY-this.mousePosition.y,this.selectedWindow.width-=t.clientX-this.mousePosition.x,this.selectedWindow.x+=t.clientX-this.mousePosition.x,this.selectedWindow.updateSize()&&this.selectedWindow.updateLocation()}else!this.pointerdown||this.dragging||this.resizing?this.dragging&&this.pointerdown&&!this.resizing&&this.selectedWindow&&(this.selectedWindow.dragStart(),this.selectedWindow.setLocationRelative(t.clientX-this.mousePosition.x,t.clientY-this.mousePosition.y)):(this.dragging=!0,this.selectedWindow&&this.selectedWindow.maximized&&(this.selectedWindow.toggleMaximized(),this.selectedWindow.setLocation(t.clientX-this.selectedWindow.width/2,t.clientY-15)));return this.mousePosition={x:t.clientX,y:t.clientY},!0}),window.addEventListener("pointerup",t=>{if(this.dragging=!1,this.pointerdown=!1,this.resizing&&this.selectedWindow.windowElement.removeClass("resizing"),this.resizing=!1,this.selectedWindow&&this.dragging&&this.selectedWindow.dragStop(),this.selectedWindow&&(this.selectedWindow=null),Date.now()-this.lastClickTime<300)for(var e of this.windows)!e.minimized&&e.isTitleBarClick(t.target)&&e.toggleMaximized();this.lastClickTime=Date.now()})}newWindow(t,e,i,s,n){let o=new Window(t,e,i,s,n);return o.id=this.nextWindowID,o.setTemplates(this.rawTemplateHTML,this.rawContentHTML),o.buildTemplate(),this.windows.push(o),this.focusWindow(this.windows.length-1),this.nextWindowID++,o}removeWindow(t){var t=parseInt(t)-1001,e=this.windows[t];document.body.removeChild(e.windowElement),this.windows.splice(t,1)}async init(){this.rawContentHTML=await(await fetch("src/template/example.html")).text(),this.rawTemplateHTML=await(await fetch("src/template/window.html")).text(),this.loaded=!0}onload(){}runBuildSteps(t){let e;for(var i of t){var s=i[0];switch(i.splice(0,1),s){case"window":e=this.newWindow(...i);break;case"select":var n=this.builder.buildSelect(...i);e.append(n);break;case"text":n=this.builder.buildParagraph(...i);e.append(n);break;case"input":var o=this.builder.buildInput(...i);e.append(o);break;case"button":o=this.builder.buildButton(...i);e.append(o)}}return e}}Element.prototype.addClass=function(t){this.hasClass(t)||(this.className=(this.className+" "+t).trim())},Element.prototype.removeClass=function(t){let e=this.className;this.hasClass(t)&&(e=e.replace(t,"").replace("  "," ").trim(),this.className=e)},Element.prototype.hasClass=function(t){let e=this.className.split(" ");return-1!=e.indexOf(t)},Element.prototype.toggleClass=function(t){this.hasClass(t)?this.removeClass(t):this.addClass(t)};