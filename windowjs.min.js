/*! windowjs 2022-02-18 */
class Window{constructor(i="WindowJS",t=100,e=100,s=350,n=400){this.title=i,this.x=t,this.y=e,this.width=s,this.height=n,this.rawHTML="",this.rawContentHTML="",this.rawTemplateHTML="",this.windowElement=document.createElement("div"),this.dragged=!1,this.minimized=!1,this.maximized=!1}dragStart(){this.dragged||(this.windowElement.addClass("dragging"),this.dragged=!0)}dragStop(){this.dragged&&(this.windowElement.removeClass("dragging"),this.dragged=!1)}setSize(i,t){this.width=i,this.height=t,this.updateSize()}center(){this.setLocation(window.innerWidth/2-this.width/2,window.innerHeight/2-this.height/2)}setLocationRelative(i,t){this.setLocation(this.x+i,this.y+t)}setLocation(i,t){0<=i&&i+this.width<=window.innerWidth&&0<=t&&t+this.height<=window.innerHeight&&(this.x=i,this.y=t,this.updateLocation(),this.onmove())}updateLocation(){this.windowElement.style.top=this.y+"px",this.windowElement.style.left=this.x+"px"}updateSize(){this.windowElement.style.width=this.width+"px",this.windowElement.style.height=this.height+"px"}onmove(){}onresize(){}isClicked(i){return this.windowElement.contains(i)}isTitleBarClick(i){return this.titleBarElement.contains(i)}buildElement(){this.buildTemplate();let i=document.createElement("div");i.innerHTML=this.rawHTML,this.windowElement=i.firstChild,this.titleBarElement=this.windowElement.getElementsByClassName("windowJSTitleBar")[0],this.body=this.windowElement.getElementsByClassName("windowJSContent")[0],this.closeButton=this.windowElement.querySelector(".windowJSTitleBarControl.close"),this.minimizeButton=this.windowElement.querySelector(".windowJSTitleBarControl.minimize"),this.maximizeButton=this.windowElement.querySelector(".windowJSTitleBarControl.maximize"),this.attachListeners()}setTemplates(i,t){this.rawTemplateHTML=i,this.rawContentHTML=t,this.buildElement()}attachListeners(){this.minimizeButton.addEventListener("click",i=>{this.toggleMinimized()}),this.maximizeButton.addEventListener("click",i=>{this.toggleMaximized()})}toggleMinimized(){this.minimized?this.windowElement.removeClass("minimized"):this.windowElement.addClass("minimized"),this.minimized=!this.minimized}toggleMaximized(){this.maximized?this.windowElement.removeClass("maximized"):this.windowElement.addClass("maximized"),this.maximized=!this.maximized}buildTemplate(){var i=this.rawContentHTML,t=this.title,t={x:this.x,y:this.y,height:this.height,width:this.width,id:this.id,title:t,content:i};this.rawHTML=this.parseTemplate(this.rawTemplateHTML,t)}parseTemplate(i,t){for(var e in t){var s=t[e];i=i.replaceAll(`\${${e}}`,s)}return i}}class WindowJS{constructor(){this.windows=[],this.nextWindowID=1001,this.init().then(()=>{this.onload()}),this.dragging=!1,this.pointerdown=!1,this.lastClickTime=0,this.selectedWindow=null,this.mousePosition={x:0,y:0},this.attachListeners()}focusWindow(i){for(var t of this.windows)t.windowElement.removeClass("focused");this.windows[i].windowElement.addClass("focused")}attachListeners(){window.addEventListener("pointerdown",t=>{for(var e in this.pointerdown=!0,this.mousePosition={x:t.clientX,y:t.clientY},this.windows){let i=this.windows[e];i.minimized?i.minimized&&i.toggleMinimized():i.isClicked(t.target)&&(i.isTitleBarClick(t.target)&&(this.selectedWindow=i),this.focusWindow(e))}0==this.lastClickTime&&(this.lastClickTime=Date.now())}),window.addEventListener("blur",i=>{this.dragging=!1,this.pointerdown=!1,this.selectedWindow&&(this.selectedWindow.dragStop(),this.selectedWindow=null)}),window.addEventListener("pointermove",i=>{this.pointerdown&&!this.dragging?(this.dragging=!0,this.selectedWindow&&this.selectedWindow.maximized&&(this.selectedWindow.toggleMaximized(),this.selectedWindow.setLocation(i.clientX-this.selectedWindow.width/2,i.clientY-15))):this.dragging&&this.selectedWindow&&(this.selectedWindow.dragStart(),this.selectedWindow.setLocationRelative(i.clientX-this.mousePosition.x,i.clientY-this.mousePosition.y)),this.mousePosition={x:i.clientX,y:i.clientY}}),window.addEventListener("pointerup",i=>{if(this.dragging=!1,this.pointerdown=!1,this.selectedWindow&&(this.selectedWindow.dragStop(),this.selectedWindow=null),Date.now()-this.lastClickTime<300)for(var t of this.windows)!t.minimized&&t.isTitleBarClick(i.target)&&t.toggleMaximized();this.lastClickTime=Date.now()})}newWindow(i,t,e,s,n){let o=new Window(i,t,e,s,n);return o.id=this.nextWindowID,o.setTemplates(this.rawTemplateHTML,this.rawContentHTML),o.buildTemplate(),this.windows.push(o),this.nextWindowID++,o}async init(){this.rawContentHTML=await(await fetch("src/template/example.html")).text(),this.rawTemplateHTML=await(await fetch("src/template/window.html")).text()}onload(){}}let winjs,win,win2;window.onload=function(){(winjs=new WindowJS).onload=function(){win=winjs.newWindow("Window One",100,100),document.body.appendChild(win.windowElement),win2=winjs.newWindow("Window Two",200,200),document.body.appendChild(win2.windowElement)}},Element.prototype.addClass=function(i){this.hasClass(i)||(this.className=(this.className+" "+i).trim())},Element.prototype.removeClass=function(i){let t=this.className;this.hasClass(i)&&(t=t.replace(i,"").replace("  "," ").trim(),this.className=t)},Element.prototype.hasClass=function(i){let t=this.className.split(" ");return-1!=t.indexOf(i)},Element.prototype.toggleClass=function(i){this.hasClass(i)?this.removeClass(i):this.addClass(i)};